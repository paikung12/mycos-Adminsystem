{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport { useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { useOwnContext } from \"./useOwnContext\";\nimport { useNameProp } from \"./commons/useNameProp\";\nimport { useMapFields } from \"./useMapFields\";\nimport { useValidators } from \"./useValidators\";\nimport { validateProps } from \"./../utils/validateProps\";\nimport { updateState } from \"./../utils/updateState\";\nimport { chainReducers } from \"./../utils/chainReducers\";\nimport { useValidationFunction } from \"./commons/useValidationFunction\";\nimport { useValidationFunctionAsync } from \"./commons/useValidationFunctionAsync\";\nimport { STATUS } from \"./../utils/constants\";\nimport { DISPATCHER_LABEL } from \"./../utils/constants\";\nimport { noop } from \"./../utils/noop\";\nvar initArray = [];\nvar initObject = {};\nvar validatorsDefault = [];\nexport function useObject(props) {\n  var context = useOwnContext();\n  var name = props.name,\n      index = props.index,\n      type = props.type,\n      initValue = props.value,\n      reducers = props.reducers,\n      _props$validators = props.validators,\n      validatorsFuncs = _props$validators === void 0 ? validatorsDefault : _props$validators,\n      _props$onValidation = props.onValidation,\n      onValidation = _props$onValidation === void 0 ? noop : _props$onValidation,\n      _props$resetSyncErr = props.resetSyncErr,\n      resetSyncErr = _props$resetSyncErr === void 0 ? noop : _props$resetSyncErr,\n      _props$resetAsyncErr = props.resetAsyncErr,\n      resetAsyncErr = _props$resetAsyncErr === void 0 ? noop : _props$resetAsyncErr,\n      asyncValidator = props.asyncValidator,\n      _props$onAsyncValidat = props.onAsyncValidation,\n      onAsyncValidation = _props$onAsyncValidat === void 0 ? noop : _props$onAsyncValidat,\n      _props$touched = props.touched,\n      touched = _props$touched === void 0 ? false : _props$touched;\n\n  var _useNameProp = useNameProp(context, name, index),\n      nameProp = _useNameProp.nameProp,\n      uniqueIDarrayContext = _useNameProp.uniqueIDarrayContext,\n      setNameProp = _useNameProp.setNameProp;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    validateProps(\"<Collection /> \", _extends({}, props, {\n      index: nameProp.current\n    }), context.type);\n  }\n\n  var _useMapFields = useMapFields(nameProp, context, type),\n      unRegisterField = _useMapFields.unRegisterField,\n      mapFields = _useMapFields.mapFields,\n      updateRegisteredField = _useMapFields.updateRegisteredField;\n\n  var applyReducers = useMemo(function () {\n    return chainReducers(reducers);\n  }, []);\n  var isMounted = useRef(false);\n  var stillMounted = useCallback(function () {\n    return isMounted.current;\n  }, []);\n  var isArray = type && type === \"array\";\n  var init = initValue || (isArray ? initArray : initObject);\n  var state = useRef(init);\n  var memoInitialState = useRef(init);\n  var prevState = useRef(isArray ? initArray : initObject);\n  var valueFieldLastSyncCheck = useRef(null); // getValue from parent context\n\n  if (!isMounted.current) {\n    state.current = initValue || context.state[nameProp.current] || init;\n  } else {\n    state.current = context.state[nameProp.current] || (isArray ? initArray : initObject);\n  }\n\n  var formState = useRef(null);\n  formState.current = context.formState;\n  var resetObj = useRef(isArray ? [] : {});\n  var registerReset = useCallback(function (namePropExt, fnReset) {\n    resetObj.current = isArray ? [].concat(resetObj.current) : _extends({}, resetObj.current);\n\n    if (isArray && typeof resetObj.current[namePropExt] !== \"undefined\") {\n      resetObj.current.splice(Number(namePropExt), 0, fnReset);\n    } else {\n      resetObj.current[namePropExt] = fnReset;\n    }\n  }, []);\n  var unRegisterReset = useCallback(function (namePropExt) {\n    if (resetObj.current.constructor === Array) {\n      resetObj.current.splice(namePropExt, 1);\n    } else {\n      delete resetObj.current[namePropExt];\n    }\n  }, []);\n  var reset = useCallback(function (formState) {\n    valueFieldLastSyncCheck.current = null;\n    var initAcc = isArray ? [] : {};\n    var obj = Object.keys(resetObj.current).reduce(function (acc, key) {\n      var value = resetObj.current[key](formState);\n      if (value !== undefined) acc[key] = value;\n      return acc;\n    }, initAcc);\n    var newValue = applyReducers(obj, memoInitialState.current, formState);\n    newValue = newValue !== undefined && Object.keys(newValue).length > 0 ? newValue : undefined;\n    return newValue;\n  }, []);\n  var updateParentProps = useCallback(function (nextState) {\n    var newState = applyReducers(nextState, state.current, formState.current);\n    var removeProp = Object.keys(newState).length === 0;\n    context.changeProp(nameProp.current, newState, removeProp);\n  }, []);\n  var changeProp = useCallback(function (namePropExt, value, removeMe) {\n    var nextState = updateState(state.current, {\n      value: value,\n      nameProp: namePropExt,\n      removeMe: removeMe\n    });\n    updateParentProps(nextState);\n  }, []);\n  var initProp = useCallback(function (namePropExt, value, intialValue, add) {\n    if (add === void 0) {\n      add = true;\n    }\n\n    var newState = updateState(state.current, {\n      value: value,\n      nameProp: namePropExt,\n      add: isMounted.current && add\n    });\n    memoInitialState.current = updateState(memoInitialState.current, {\n      value: intialValue,\n      nameProp: namePropExt,\n      add: isMounted.current && add\n    });\n    var reducedState = applyReducers(newState, state.current, formState.current);\n    prevState.current = newState;\n\n    if (isMounted.current) {\n      context.initProp(nameProp.current, reducedState, memoInitialState.current, false);\n    } else {\n      state.current = reducedState;\n    }\n  }, []);\n\n  var _useRef = useRef(function (namePropExt, _ref, willUnmount) {\n    var currentState = _ref.currentState,\n        removeCurrent = _ref.removeCurrent,\n        initialState = _ref.initialState,\n        removeInitial = _ref.removeInitial;\n\n    if (willUnmount === void 0) {\n      willUnmount = false;\n    }\n\n    var newStateCurrent = updateState(state.current, {\n      value: currentState,\n      nameProp: namePropExt,\n      removeMe: removeCurrent\n    });\n    var newStateInitial = updateState(memoInitialState.current, {\n      value: initialState,\n      nameProp: namePropExt,\n      removeMe: removeInitial\n    });\n\n    if (willUnmount && isArray) {\n      newStateCurrent = newStateCurrent.filter(function (elm, index) {\n        return index !== namePropExt;\n      });\n      newStateInitial = newStateInitial.filter(function (elm, index) {\n        return index !== namePropExt;\n      });\n    }\n\n    var reducedState = applyReducers(newStateCurrent, state.current, formState.current);\n    state.current = reducedState;\n    memoInitialState.current = newStateInitial;\n    var removeCurrentProp = Object.keys(state.current).length === 0;\n    var removeInitialProp = Object.keys(memoInitialState.current).length === 0;\n    context.removeProp(nameProp.current, {\n      currentState: state.current,\n      removeCurrent: removeCurrentProp,\n      initialState: memoInitialState.current,\n      removeInitial: removeInitialProp\n    });\n  }),\n      removeProp = _useRef.current;\n\n  var setValue = useCallback(function (resolveNextState) {\n    var nextState = typeof resolveNextState === \"function\" ? resolveNextState(state.current) : resolveNextState;\n    updateParentProps(nextState);\n  }, []);\n\n  var _useValidators = useValidators(context, nameProp, isMounted),\n      validators = _useValidators[0],\n      addValidators = _useValidators[1],\n      removeValidators = _useValidators[2];\n\n  var _useValidators2 = useValidators(context, nameProp, isMounted, true),\n      validatorsAsync = _useValidators2[0],\n      addValidatorsAsync = _useValidators2[1],\n      removeValidatorsAsync = _useValidators2[2],\n      validatorsMapsAsync = _useValidators2[3],\n      updateValidatorsMap = _useValidators2[4];\n\n  var _useValidationFunctio = useValidationFunction(validatorsFuncs),\n      validationMsg = _useValidationFunctio.validationMsg,\n      validationObj = _useValidationFunctio.validationObj,\n      validationFN = _useValidationFunctio.validationFN;\n\n  var _useValidationFunctio2 = useValidationFunctionAsync(asyncValidator, onAsyncValidation),\n      validationFNAsync = _useValidationFunctio2[0];\n\n  var triggerSyncValidation = useCallback(function (propagate, onSubmit) {\n    if (propagate === void 0) {\n      propagate = true;\n    }\n\n    if (onSubmit === void 0) {\n      onSubmit = false;\n    }\n\n    if (valueFieldLastSyncCheck.current !== state.current) {\n      if (validationObj.current !== null && (touched || onSubmit)) {\n        valueFieldLastSyncCheck.current = state.current;\n        var _validationObj$curren = validationObj.current,\n            isValid = _validationObj$curren.isValid,\n            checks = _validationObj$curren.checks;\n        onValidation(checks, isValid);\n      }\n\n      if (propagate) {\n        context == null ? void 0 : context.triggerSyncValidation == null ? void 0 : context.triggerSyncValidation();\n      }\n    }\n  }, []);\n  useEffect(function () {\n    if (context.formStatus === STATUS.ON_RESET) {\n      resetSyncErr();\n      resetAsyncErr();\n    } else if (context.formStatus !== STATUS.READY && context.formStatus !== STATUS.ON_INIT_ASYNC) {\n      if (validationObj.current !== null && context.formStatus === STATUS.ON_SUBMIT) {\n        triggerSyncValidation(false, true);\n      }\n\n      if (validationObj.current !== null && !validationObj.current.isValid) {\n        resetAsyncErr();\n      }\n    }\n  }, [validationMsg.current, context.formStatus]); // used to register async validation Actions\n\n  var asyncInitValidation = useRef({});\n  var registerAsyncInitValidation = useCallback(function (nameProp, asyncFunc) {\n    asyncInitValidation.current[nameProp] = asyncFunc;\n  }, []);\n  useEffect(function () {\n    isMounted.current = true;\n\n    if (context.type === \"array\") {\n      context.registerIndex(uniqueIDarrayContext, setNameProp);\n    } // Add its own validators\n\n\n    if (validatorsFuncs.length > 0) {\n      context.addValidators(nameProp.current, validationFN.current);\n    }\n\n    if (typeof asyncValidator === \"function\") {\n      context.addValidatorsAsync(nameProp.current, validationFNAsync.current, null);\n    }\n\n    mapFields.current[DISPATCHER_LABEL] = setValue;\n    context.updateRegisteredField(nameProp.current, mapFields.current); // register to parent any initial async Validators to be run ON_INIT\n\n    if (Object.keys(asyncInitValidation.current).length > 0) {\n      context.registerAsyncInitValidation(nameProp.current, asyncInitValidation.current);\n    } // --- Add its own validators --- //\n    // Add its children validators\n\n\n    if (Object.keys(validators.current).length > 0) {\n      context.addValidators(nameProp.current, validators.current);\n    }\n\n    if (Object.keys(validatorsAsync.current).length > 0) {\n      context.addValidatorsAsync(nameProp.current, validatorsAsync.current, validatorsMapsAsync.current);\n    } // --- Add the its children validators --- //\n\n\n    context.registerReset(nameProp.current, reset);\n    var newState = applyReducers(state.current, prevState.current, formState.current);\n    context.initProp(nameProp.current, newState, memoInitialState.current);\n    return function () {\n      resetSyncErr();\n      resetAsyncErr();\n      isMounted.current = false;\n\n      if (context.stillMounted()) {\n        context.unRegisterField(nameProp.current); // remove its own by validators\n\n        if (typeof asyncValidator === \"function\") {\n          context.removeValidatorsAsync(nameProp.current, validationFNAsync.current, false);\n        }\n\n        if (validatorsFuncs.length > 0) {\n          context.removeValidators(nameProp.current, validationFN.current);\n        } // ----- remove its own by validators ----- //\n        // remove validators inerithed by children\n\n\n        if (Object.keys(validators.current).length > 0) {\n          context.removeValidators(nameProp.current, validators.current);\n        }\n\n        if (Object.keys(validatorsAsync.current).length > 0) {\n          context.removeValidatorsAsync(nameProp.current, validatorsAsync.current, validatorsMapsAsync.current);\n        } // ----- remove validators inerithed by children ----- //\n\n\n        context.removeProp(nameProp.current, {\n          removeCurrent: true,\n          removeInitial: true\n        }, true);\n        context.unRegisterReset(nameProp.current);\n\n        if (context.type === \"array\") {\n          context.removeIndex(uniqueIDarrayContext);\n        }\n      }\n    };\n  }, []);\n  var childrenIndexes = useRef({});\n  var getIndex = useCallback(function (idCpm) {\n    if (childrenIndexes.current[idCpm] === undefined) {\n      childrenIndexes.current[idCpm] = null;\n    }\n\n    return Object.keys(childrenIndexes.current).length - 1;\n  }, []);\n  var removeIndex = useCallback(function (idCpm) {\n    delete childrenIndexes.current[idCpm];\n    Object.keys(childrenIndexes.current).forEach(function (idField, index) {\n      return childrenIndexes.current[idField](index);\n    });\n  }, []);\n  var registerIndex = useCallback(function (idCpm, fn) {\n    childrenIndexes.current[idCpm] = fn;\n  }, []);\n  return {\n    state: state.current,\n    // pass the state of the current context down\n    formState: context.formState,\n    // pass the global form state down\n    formStatus: context.formStatus,\n    // pass the global form status down\n    runAsyncValidation: context.runAsyncValidation,\n    unRegisterField: unRegisterField,\n    updateRegisteredField: updateRegisteredField,\n    registerAsyncInitValidation: registerAsyncInitValidation,\n    changeProp: changeProp,\n    initProp: initProp,\n    removeProp: removeProp,\n    stillMounted: stillMounted,\n    getIndex: getIndex,\n    removeIndex: removeIndex,\n    registerIndex: registerIndex,\n    type: type,\n    addValidators: addValidators,\n    removeValidators: removeValidators,\n    addValidatorsAsync: addValidatorsAsync,\n    removeValidatorsAsync: removeValidatorsAsync,\n    updateValidatorsMap: updateValidatorsMap,\n    registerReset: registerReset,\n    unRegisterReset: unRegisterReset,\n    triggerSyncValidation: triggerSyncValidation\n  };\n}","map":{"version":3,"sources":["/Users/auttapongkompiban/Spec_mycos/mycos-makub/node_modules/usetheform/build/es/hooks/useObject.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","useRef","useEffect","useCallback","useMemo","useOwnContext","useNameProp","useMapFields","useValidators","validateProps","updateState","chainReducers","useValidationFunction","useValidationFunctionAsync","STATUS","DISPATCHER_LABEL","noop","initArray","initObject","validatorsDefault","useObject","props","context","name","index","type","initValue","value","reducers","_props$validators","validators","validatorsFuncs","_props$onValidation","onValidation","_props$resetSyncErr","resetSyncErr","_props$resetAsyncErr","resetAsyncErr","asyncValidator","_props$onAsyncValidat","onAsyncValidation","_props$touched","touched","_useNameProp","nameProp","uniqueIDarrayContext","setNameProp","process","env","NODE_ENV","current","_useMapFields","unRegisterField","mapFields","updateRegisteredField","applyReducers","isMounted","stillMounted","isArray","init","state","memoInitialState","prevState","valueFieldLastSyncCheck","formState","resetObj","registerReset","namePropExt","fnReset","concat","splice","Number","unRegisterReset","constructor","Array","reset","initAcc","obj","keys","reduce","acc","undefined","newValue","updateParentProps","nextState","newState","removeProp","changeProp","removeMe","initProp","intialValue","add","reducedState","_useRef","_ref","willUnmount","currentState","removeCurrent","initialState","removeInitial","newStateCurrent","newStateInitial","filter","elm","removeCurrentProp","removeInitialProp","setValue","resolveNextState","_useValidators","addValidators","removeValidators","_useValidators2","validatorsAsync","addValidatorsAsync","removeValidatorsAsync","validatorsMapsAsync","updateValidatorsMap","_useValidationFunctio","validationMsg","validationObj","validationFN","_useValidationFunctio2","validationFNAsync","triggerSyncValidation","propagate","onSubmit","_validationObj$curren","isValid","checks","formStatus","ON_RESET","READY","ON_INIT_ASYNC","ON_SUBMIT","asyncInitValidation","registerAsyncInitValidation","asyncFunc","registerIndex","removeIndex","childrenIndexes","getIndex","idCpm","forEach","idField","fn","runAsyncValidation"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { useOwnContext } from \"./useOwnContext\";\nimport { useNameProp } from \"./commons/useNameProp\";\nimport { useMapFields } from \"./useMapFields\";\nimport { useValidators } from \"./useValidators\";\nimport { validateProps } from \"./../utils/validateProps\";\nimport { updateState } from \"./../utils/updateState\";\nimport { chainReducers } from \"./../utils/chainReducers\";\nimport { useValidationFunction } from \"./commons/useValidationFunction\";\nimport { useValidationFunctionAsync } from \"./commons/useValidationFunctionAsync\";\nimport { STATUS } from \"./../utils/constants\";\nimport { DISPATCHER_LABEL } from \"./../utils/constants\";\nimport { noop } from \"./../utils/noop\";\nvar initArray = [];\nvar initObject = {};\nvar validatorsDefault = [];\nexport function useObject(props) {\n  var context = useOwnContext();\n  var name = props.name,\n      index = props.index,\n      type = props.type,\n      initValue = props.value,\n      reducers = props.reducers,\n      _props$validators = props.validators,\n      validatorsFuncs = _props$validators === void 0 ? validatorsDefault : _props$validators,\n      _props$onValidation = props.onValidation,\n      onValidation = _props$onValidation === void 0 ? noop : _props$onValidation,\n      _props$resetSyncErr = props.resetSyncErr,\n      resetSyncErr = _props$resetSyncErr === void 0 ? noop : _props$resetSyncErr,\n      _props$resetAsyncErr = props.resetAsyncErr,\n      resetAsyncErr = _props$resetAsyncErr === void 0 ? noop : _props$resetAsyncErr,\n      asyncValidator = props.asyncValidator,\n      _props$onAsyncValidat = props.onAsyncValidation,\n      onAsyncValidation = _props$onAsyncValidat === void 0 ? noop : _props$onAsyncValidat,\n      _props$touched = props.touched,\n      touched = _props$touched === void 0 ? false : _props$touched;\n\n  var _useNameProp = useNameProp(context, name, index),\n      nameProp = _useNameProp.nameProp,\n      uniqueIDarrayContext = _useNameProp.uniqueIDarrayContext,\n      setNameProp = _useNameProp.setNameProp;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    validateProps(\"<Collection /> \", _extends({}, props, {\n      index: nameProp.current\n    }), context.type);\n  }\n\n  var _useMapFields = useMapFields(nameProp, context, type),\n      unRegisterField = _useMapFields.unRegisterField,\n      mapFields = _useMapFields.mapFields,\n      updateRegisteredField = _useMapFields.updateRegisteredField;\n\n  var applyReducers = useMemo(function () {\n    return chainReducers(reducers);\n  }, []);\n  var isMounted = useRef(false);\n  var stillMounted = useCallback(function () {\n    return isMounted.current;\n  }, []);\n  var isArray = type && type === \"array\";\n  var init = initValue || (isArray ? initArray : initObject);\n  var state = useRef(init);\n  var memoInitialState = useRef(init);\n  var prevState = useRef(isArray ? initArray : initObject);\n  var valueFieldLastSyncCheck = useRef(null); // getValue from parent context\n\n  if (!isMounted.current) {\n    state.current = initValue || context.state[nameProp.current] || init;\n  } else {\n    state.current = context.state[nameProp.current] || (isArray ? initArray : initObject);\n  }\n\n  var formState = useRef(null);\n  formState.current = context.formState;\n  var resetObj = useRef(isArray ? [] : {});\n  var registerReset = useCallback(function (namePropExt, fnReset) {\n    resetObj.current = isArray ? [].concat(resetObj.current) : _extends({}, resetObj.current);\n\n    if (isArray && typeof resetObj.current[namePropExt] !== \"undefined\") {\n      resetObj.current.splice(Number(namePropExt), 0, fnReset);\n    } else {\n      resetObj.current[namePropExt] = fnReset;\n    }\n  }, []);\n  var unRegisterReset = useCallback(function (namePropExt) {\n    if (resetObj.current.constructor === Array) {\n      resetObj.current.splice(namePropExt, 1);\n    } else {\n      delete resetObj.current[namePropExt];\n    }\n  }, []);\n  var reset = useCallback(function (formState) {\n    valueFieldLastSyncCheck.current = null;\n    var initAcc = isArray ? [] : {};\n    var obj = Object.keys(resetObj.current).reduce(function (acc, key) {\n      var value = resetObj.current[key](formState);\n      if (value !== undefined) acc[key] = value;\n      return acc;\n    }, initAcc);\n    var newValue = applyReducers(obj, memoInitialState.current, formState);\n    newValue = newValue !== undefined && Object.keys(newValue).length > 0 ? newValue : undefined;\n    return newValue;\n  }, []);\n  var updateParentProps = useCallback(function (nextState) {\n    var newState = applyReducers(nextState, state.current, formState.current);\n    var removeProp = Object.keys(newState).length === 0;\n    context.changeProp(nameProp.current, newState, removeProp);\n  }, []);\n  var changeProp = useCallback(function (namePropExt, value, removeMe) {\n    var nextState = updateState(state.current, {\n      value: value,\n      nameProp: namePropExt,\n      removeMe: removeMe\n    });\n    updateParentProps(nextState);\n  }, []);\n  var initProp = useCallback(function (namePropExt, value, intialValue, add) {\n    if (add === void 0) {\n      add = true;\n    }\n\n    var newState = updateState(state.current, {\n      value: value,\n      nameProp: namePropExt,\n      add: isMounted.current && add\n    });\n    memoInitialState.current = updateState(memoInitialState.current, {\n      value: intialValue,\n      nameProp: namePropExt,\n      add: isMounted.current && add\n    });\n    var reducedState = applyReducers(newState, state.current, formState.current);\n    prevState.current = newState;\n\n    if (isMounted.current) {\n      context.initProp(nameProp.current, reducedState, memoInitialState.current, false);\n    } else {\n      state.current = reducedState;\n    }\n  }, []);\n\n  var _useRef = useRef(function (namePropExt, _ref, willUnmount) {\n    var currentState = _ref.currentState,\n        removeCurrent = _ref.removeCurrent,\n        initialState = _ref.initialState,\n        removeInitial = _ref.removeInitial;\n\n    if (willUnmount === void 0) {\n      willUnmount = false;\n    }\n\n    var newStateCurrent = updateState(state.current, {\n      value: currentState,\n      nameProp: namePropExt,\n      removeMe: removeCurrent\n    });\n    var newStateInitial = updateState(memoInitialState.current, {\n      value: initialState,\n      nameProp: namePropExt,\n      removeMe: removeInitial\n    });\n\n    if (willUnmount && isArray) {\n      newStateCurrent = newStateCurrent.filter(function (elm, index) {\n        return index !== namePropExt;\n      });\n      newStateInitial = newStateInitial.filter(function (elm, index) {\n        return index !== namePropExt;\n      });\n    }\n\n    var reducedState = applyReducers(newStateCurrent, state.current, formState.current);\n    state.current = reducedState;\n    memoInitialState.current = newStateInitial;\n    var removeCurrentProp = Object.keys(state.current).length === 0;\n    var removeInitialProp = Object.keys(memoInitialState.current).length === 0;\n    context.removeProp(nameProp.current, {\n      currentState: state.current,\n      removeCurrent: removeCurrentProp,\n      initialState: memoInitialState.current,\n      removeInitial: removeInitialProp\n    });\n  }),\n      removeProp = _useRef.current;\n\n  var setValue = useCallback(function (resolveNextState) {\n    var nextState = typeof resolveNextState === \"function\" ? resolveNextState(state.current) : resolveNextState;\n    updateParentProps(nextState);\n  }, []);\n\n  var _useValidators = useValidators(context, nameProp, isMounted),\n      validators = _useValidators[0],\n      addValidators = _useValidators[1],\n      removeValidators = _useValidators[2];\n\n  var _useValidators2 = useValidators(context, nameProp, isMounted, true),\n      validatorsAsync = _useValidators2[0],\n      addValidatorsAsync = _useValidators2[1],\n      removeValidatorsAsync = _useValidators2[2],\n      validatorsMapsAsync = _useValidators2[3],\n      updateValidatorsMap = _useValidators2[4];\n\n  var _useValidationFunctio = useValidationFunction(validatorsFuncs),\n      validationMsg = _useValidationFunctio.validationMsg,\n      validationObj = _useValidationFunctio.validationObj,\n      validationFN = _useValidationFunctio.validationFN;\n\n  var _useValidationFunctio2 = useValidationFunctionAsync(asyncValidator, onAsyncValidation),\n      validationFNAsync = _useValidationFunctio2[0];\n\n  var triggerSyncValidation = useCallback(function (propagate, onSubmit) {\n    if (propagate === void 0) {\n      propagate = true;\n    }\n\n    if (onSubmit === void 0) {\n      onSubmit = false;\n    }\n\n    if (valueFieldLastSyncCheck.current !== state.current) {\n      if (validationObj.current !== null && (touched || onSubmit)) {\n        valueFieldLastSyncCheck.current = state.current;\n        var _validationObj$curren = validationObj.current,\n            isValid = _validationObj$curren.isValid,\n            checks = _validationObj$curren.checks;\n        onValidation(checks, isValid);\n      }\n\n      if (propagate) {\n        context == null ? void 0 : context.triggerSyncValidation == null ? void 0 : context.triggerSyncValidation();\n      }\n    }\n  }, []);\n  useEffect(function () {\n    if (context.formStatus === STATUS.ON_RESET) {\n      resetSyncErr();\n      resetAsyncErr();\n    } else if (context.formStatus !== STATUS.READY && context.formStatus !== STATUS.ON_INIT_ASYNC) {\n      if (validationObj.current !== null && context.formStatus === STATUS.ON_SUBMIT) {\n        triggerSyncValidation(false, true);\n      }\n\n      if (validationObj.current !== null && !validationObj.current.isValid) {\n        resetAsyncErr();\n      }\n    }\n  }, [validationMsg.current, context.formStatus]); // used to register async validation Actions\n\n  var asyncInitValidation = useRef({});\n  var registerAsyncInitValidation = useCallback(function (nameProp, asyncFunc) {\n    asyncInitValidation.current[nameProp] = asyncFunc;\n  }, []);\n  useEffect(function () {\n    isMounted.current = true;\n\n    if (context.type === \"array\") {\n      context.registerIndex(uniqueIDarrayContext, setNameProp);\n    } // Add its own validators\n\n\n    if (validatorsFuncs.length > 0) {\n      context.addValidators(nameProp.current, validationFN.current);\n    }\n\n    if (typeof asyncValidator === \"function\") {\n      context.addValidatorsAsync(nameProp.current, validationFNAsync.current, null);\n    }\n\n    mapFields.current[DISPATCHER_LABEL] = setValue;\n    context.updateRegisteredField(nameProp.current, mapFields.current); // register to parent any initial async Validators to be run ON_INIT\n\n    if (Object.keys(asyncInitValidation.current).length > 0) {\n      context.registerAsyncInitValidation(nameProp.current, asyncInitValidation.current);\n    } // --- Add its own validators --- //\n    // Add its children validators\n\n\n    if (Object.keys(validators.current).length > 0) {\n      context.addValidators(nameProp.current, validators.current);\n    }\n\n    if (Object.keys(validatorsAsync.current).length > 0) {\n      context.addValidatorsAsync(nameProp.current, validatorsAsync.current, validatorsMapsAsync.current);\n    } // --- Add the its children validators --- //\n\n\n    context.registerReset(nameProp.current, reset);\n    var newState = applyReducers(state.current, prevState.current, formState.current);\n    context.initProp(nameProp.current, newState, memoInitialState.current);\n    return function () {\n      resetSyncErr();\n      resetAsyncErr();\n      isMounted.current = false;\n\n      if (context.stillMounted()) {\n        context.unRegisterField(nameProp.current); // remove its own by validators\n\n        if (typeof asyncValidator === \"function\") {\n          context.removeValidatorsAsync(nameProp.current, validationFNAsync.current, false);\n        }\n\n        if (validatorsFuncs.length > 0) {\n          context.removeValidators(nameProp.current, validationFN.current);\n        } // ----- remove its own by validators ----- //\n        // remove validators inerithed by children\n\n\n        if (Object.keys(validators.current).length > 0) {\n          context.removeValidators(nameProp.current, validators.current);\n        }\n\n        if (Object.keys(validatorsAsync.current).length > 0) {\n          context.removeValidatorsAsync(nameProp.current, validatorsAsync.current, validatorsMapsAsync.current);\n        } // ----- remove validators inerithed by children ----- //\n\n\n        context.removeProp(nameProp.current, {\n          removeCurrent: true,\n          removeInitial: true\n        }, true);\n        context.unRegisterReset(nameProp.current);\n\n        if (context.type === \"array\") {\n          context.removeIndex(uniqueIDarrayContext);\n        }\n      }\n    };\n  }, []);\n  var childrenIndexes = useRef({});\n  var getIndex = useCallback(function (idCpm) {\n    if (childrenIndexes.current[idCpm] === undefined) {\n      childrenIndexes.current[idCpm] = null;\n    }\n\n    return Object.keys(childrenIndexes.current).length - 1;\n  }, []);\n  var removeIndex = useCallback(function (idCpm) {\n    delete childrenIndexes.current[idCpm];\n    Object.keys(childrenIndexes.current).forEach(function (idField, index) {\n      return childrenIndexes.current[idField](index);\n    });\n  }, []);\n  var registerIndex = useCallback(function (idCpm, fn) {\n    childrenIndexes.current[idCpm] = fn;\n  }, []);\n  return {\n    state: state.current,\n    // pass the state of the current context down\n    formState: context.formState,\n    // pass the global form state down\n    formStatus: context.formStatus,\n    // pass the global form status down\n    runAsyncValidation: context.runAsyncValidation,\n    unRegisterField: unRegisterField,\n    updateRegisteredField: updateRegisteredField,\n    registerAsyncInitValidation: registerAsyncInitValidation,\n    changeProp: changeProp,\n    initProp: initProp,\n    removeProp: removeProp,\n    stillMounted: stillMounted,\n    getIndex: getIndex,\n    removeIndex: removeIndex,\n    registerIndex: registerIndex,\n    type: type,\n    addValidators: addValidators,\n    removeValidators: removeValidators,\n    addValidatorsAsync: addValidatorsAsync,\n    removeValidatorsAsync: removeValidatorsAsync,\n    updateValidatorsMap: updateValidatorsMap,\n    registerReset: registerReset,\n    unRegisterReset: unRegisterReset,\n    triggerSyncValidation: triggerSyncValidation\n  };\n}"]},"metadata":{},"sourceType":"module"}