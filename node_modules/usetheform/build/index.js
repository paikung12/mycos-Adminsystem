"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e);function n(){return(n=Object.assign||function(e){for(var r=1;arguments.length>r;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function u(e,r){if(null==e)return{};var t,n,u={},a=Object.keys(e);for(n=0;a.length>n;n++)0>r.indexOf(t=a[n])&&(u[t]=e[t]);return u}function a(e,r,t){var n={};if("object"==typeof r&&null!==r)n=Object.keys(r).reduce((function(n,u){return t?n[e+"/"+u]=void 0:void 0!==r[u]&&(n[e+"/"+u]=r[u]),n}),{});else if("function"==typeof r){var u,a;n=t?((u={})[e]=void 0,u):((a={})[e]=r,a)}else if("boolean"==typeof r||null===r){var c,i,o=null===r?{type:"collection",isValid:r,counter:0}:{type:"field",isValid:r,counter:0};n=t?((c={})[e]=void 0,c):((i={})[e]=o,i)}return n}function c(r,t,u,c){void 0===c&&(c=!1);var o=e.useRef({}),s=e.useRef({}),l=e.useCallback((function(e,u,a){void 0!==r?r.updateValidatorsMap(t.current+"/"+e,u,a):s.current[e]=n({},s.current[e],{isValid:u,counter:a})}),[]),d=e.useCallback((function(){return Object.keys(s.current).forEach((function(e){var r=s.current[e].type;s.current[e].counter=0,s.current[e].isValid="collection"===r&&null})),s.current}),[]),f=e.useRef((function(e,i,l){(o.current=n({},o.current,a(e,i)),c&&(s.current=n({},s.current,a(e,l))),void 0!==t&&u.current&&void 0!==r)&&(c?r.addValidatorsAsync:r.addValidators)(t.current,o.current,s.current)})).current,v=e.useRef((function(e,u,l){void 0===l&&(l=!1);var d=n({},o.current,a(e,u,!0)),f=c?n({},s.current,a(e,l,!0)):{};void 0!==r?(o.current=d,s.current=f,(c?r.removeValidatorsAsync:r.removeValidators)(t.current,o.current,s.current)):(o.current=i(d),s.current=i(f))}));return[o,f,v.current,s,l,d]}function i(e){return Object.keys(e).forEach((function(r){void 0===e[r]&&delete e[r]})),e}function o(r,t,n){void 0===n&&(n="object");var u=e.useRef({}),a=e.useCallback((function(e,r){u.current[e]=r}),[]);return{unRegisterField:e.useCallback((function(e){var a,c,i,o,s;delete u.current[e],"array"===n&&(u.current=(s=(a=u.current)[o=(i=Object.keys(a))[i.length-1]],i.pop(),i.map((function(e){return a[e]})).reduce((function(e,r,t){return e[t]=r,e}),((c={})[o]=s,c)))),null==t||null==t.updateRegisteredField||t.updateRegisteredField(r.current,u.current)}),[]),mapFields:u,updateRegisteredField:a}}function s(e){return e.filter((function(e){return null!=e}))[0]}function l(r){void 0===r&&(r=[]);var t=e.useRef(void 0),n=e.useRef(null),u=e.useRef((function(e,u){var a=function(e,r,t){void 0===r&&(r=[]);var n=r.map((function(r){return r(e,t)})),u=n.every((function(e){return null==e}));return{checks:n,isValid:u}}(e,r,u),c=a.isValid,i=a.checks;return t.current=s(i),n.current={isValid:c,checks:i},c}));return{validationMsg:t,validationObj:n,validationFN:u}}function d(r,t){var n=e.useRef(void 0),u=e.useRef(null);return[e.useRef((function(e){var a=void 0===e?"":e,c=Date.now();return u.current=c,t({status:"asyncStart"}),new Promise((function(e,i){r(a).then((function(r){u.current===c?(n.current=r,t({status:"asyncSuccess",value:r}),e(r)):i("cancelled")})).catch((function(e){u.current===c?(n.current=e,t({status:"asyncError",value:e}),i(e)):i("cancelled")}))}))}))]}function f(e,r){var t=r.nameProp,u=r.value,a=r.removeMe,c=r.add,i=void 0!==c&&c,o=e.constructor===Array,s=o?e.slice():n({},e);return i&&o&&void 0!==s[t]?s.splice(t,0,u):s[t]=u,(a||null==u||u.constructor===Array&&u.every((function(e){return void 0===e}))||"object"==typeof u&&"File"!==u.constructor.name&&0===Object.keys(u).length||"string"==typeof u&&""===u)&&delete s[t],s}var v=function(e){return e};function y(e){return void 0===e&&(e=[]),"function"==typeof e?e:0===e.length?v:function(r,t,n){return e.reduce((function(e,r,u){return u>0?r(e,t,n):e}),e[0](r,t,n))}}var m={ON_RESET:"ON_RESET",READY:"READY",RESETTED:"RESETTED",ON_CHANGE:"ON_CHANGE",ON_INIT:"ON_INIT",ON_SUBMIT:"ON_SUBMIT",ON_INIT_ASYNC:"ON_INIT_ASYNC",ON_RUN_ASYNC:"ON_RUN_ASYNC",ON_ASYNC_END:"ON_ASYNC_END"},p=function(e,r,t){return void 0===t&&(t="/"),"__$$USETHEFORM_VALIDATION$$__"===e?r:(Array.isArray(e)?e:e.split(t)).reduce((function(e,r){return e&&e[r]}),r)},V=function(e,r){return Object.keys(e).reduce((function(t,n){var u=p(n,r);return e[n](u,r)&&t}),!0)},S=function(e){return Object.keys(e).filter((function(r){return"field"===e[r].type})).every((function(r){var t=e[r];return 1===t.counter&&t.isValid}))},b=function(e){return Object.keys(e).filter((function(r){return"field"===e[r].type})).every((function(r){var t=e[r],n=t.isValid,u=t.counter;return 0===u&&!n||1===u&&n}))},h=function e(r){return Object.keys(r).reduce((function(t,n){var u=r[n];if("function"==typeof u)t.push(u());else{var a=e(u);t.push.apply(t,a)}return t}),[])},g={},E=[];function R(r){var t=r.initialState,a=r.touched,i=r.onChange,s=void 0===i?v:i,R=r.onReset,A=void 0===R?v:R,_=r.onInit,C=void 0===_?v:_,N=r.onSubmit,k=void 0===N?v:N,O=r.onValidation,I=void 0===O?v:O,x=r.resetSyncErr,F=void 0===x?v:x,M=r.validators,T=void 0===M?E:M,P=r.resetAsyncErr,j=void 0===P?v:P,D=r.asyncValidator,Y=r.onAsyncValidation,B=void 0===Y?v:Y,$=r.reducers,U=r._getInitilaStateForm_,H=r._onMultipleForm_,w=r.name,G=r.action,q=e.useState((function(){return void 0===(e=t)&&(e={}),{state:e,isValid:!0,status:m.READY,pristine:!0,isSubmitting:!1,submitAttempts:0,submitted:0};var e})),L=q[0],z=q[1],J=e.useRef(L),K=e.useRef(function(e,r,t){return"function"==typeof e&&"function"==typeof r&&"string"==typeof t}(U,H,w)).current,Q=e.useCallback((function(e){var r=e.state,t=e.status,a=u(e,["state","status"]),c=t===m.ON_RESET?W.current.state:t===m.ON_INIT?g:J.current.state,i=t===m.READY||t===m.ON_SUBMIT?r:pe(r,c,c);J.current=n({},a,{status:t,state:i}),z(J.current)}),[]),W=e.useRef(n({},L)),X=e.useRef(!1),Z=e.useCallback((function(){return X.current}),[]),ee=c(void 0,void 0,X),re=ee[0],te=ee[1],ne=ee[2],ue=l(T),ae=ue.validationMsg,ce=ue.validationObj,ie=ue.validationFN,oe=d(D,B)[0],se=c(void 0,void 0,X,!0),le=se[0],de=se[1],fe=se[2],ve=se[3],ye=se[4],me=se[5],pe=e.useMemo((function(){return y($)}),[]),Ve=o(),Se=Ve.unRegisterField,be=Ve.mapFields,he=Ve.updateRegisteredField,ge=e.useCallback((function(e,r,t){void 0===t&&(t=!1);var n=f(J.current.state,{value:r,nameProp:e,removeMe:t});Ae(n,!1)}),[]),Ee=e.useCallback((function(e,r,t){if(X.current){W.current.state=f(W.current.state,{isValid:t,nameProp:e});var n=f(J.current.state,{value:r,nameProp:e});Ae(n,!1)}else{var u=f(W.current.state,{value:t,nameProp:e}),a=f(J.current.state,{value:r,nameProp:e});W.current.state=u,J.current.state=a}}),[]),Re=e.useCallback((function(e,r){var t=r.initialState,n=r.removeInitial,u=f(J.current.state,{value:r.currentState,nameProp:e,removeMe:r.removeCurrent});W.current.state=f(W.current.state,{value:t,nameProp:e,removeMe:n}),Ae(u)}),[]),Ae=e.useCallback((function(e,r,t){void 0===t&&(t=m.ON_CHANGE);var u=void 0!==r?r:J.current.pristine,a=V(re.current,e)&&S(ve.current);Q(n({},J.current,{state:e,isValid:a,pristine:u,status:t}))}),[]),_e=e.useRef({}),Ce=e.useCallback((function(e,r){var t;_e.current=n({},_e.current,((t={})[e]=r,t))}),[]),Ne=e.useCallback((function(e){delete _e.current[e]}),[]),ke=e.useCallback((function(){var e=Object.keys(_e.current).reduce((function(e,r){var t=_e.current[r](W.current.state);return void 0!==t&&(e[r]=t),e}),{}),r=me(),t=V(re.current,e)&&S(r);Q(n({},W.current,{state:e,status:m.ON_RESET,isValid:t}))}),[]),Oe=e.useCallback((function(e){e.persist();var r=J.current,t=r.isValid,u=r.submitAttempts,a=m.ON_SUBMIT;"string"==typeof G&&t||e.preventDefault();var c=u+1;if(t&&Object.keys(le.current).length>0&&b(ve.current)){var i=function(e,r,t,n){return Object.keys(e).filter((function(e){var t=r[e],n=t.type;return 0===t.counter&&!t.isValid&&"field"===n||"collection"===n})).map((function(r){var u=p(r,t);return e[r](u,t).then((function(e){return n(r,!0,1),e})).catch((function(e){throw n(r,!1,1),e}))}))}(le.current,ve.current,J.current.state,ye),o=e.target;e.preventDefault(),Q(n({},J.current,{isValid:!1,isSubmitting:!0,submitAttempts:c})),Promise.all(i).then((function(){"string"==typeof G?o.submit():Q(n({},J.current,{status:a,isValid:!0}))})).catch((function(){var e=b(ve.current);Q(n({},J.current,{isValid:e,isSubmitting:!1}))}))}else Q(n({},J.current,{status:a,isSubmitting:!0,submitAttempts:c}))}),[]),Ie=e.useCallback((function(e){var r=e;"function"==typeof e&&(r=e(J.current.state));Ae(r,!1)}),[]),xe=e.useRef(!1),Fe=e.useRef(null),Me=e.useCallback((function(e,r,t){if(void 0===t&&(t=!0),Fe.current!==J.current.state&&null!==ce.current&&(xe.current||a&&t||!a)){xe.current=!0,Fe.current=J.current.state;var n=ce.current;I(n.checks,n.isValid)}}),[]),Te=e.useRef({}),Pe=e.useCallback((function(e,r){Te.current[e]=r}),[]),je=e.useCallback((function(){if(Object.keys(Te.current).length>0){Q(n({},J.current,{status:m.ON_INIT_ASYNC}));var e=h(Te.current);Promise.all(e).then((function(){var e=m.READY,r=V(re.current,J.current.state);Q(n({},J.current,{status:e,isValid:r}))})).catch((function(){Q(n({},J.current,{status:m.READY,isValid:!1}))}))}}),[]),De=e.useCallback((function(e){var r=e.end;if(e.start)Q(n({},J.current,{isValid:!1,status:m.ON_RUN_ASYNC}));else if(r){var t=m.ON_ASYNC_END,u=V(re.current,J.current.state)&&S(ve.current);Q(n({},J.current,{isValid:u,status:t}))}}),[]);return e.useEffect((function(){var e=J.current,r=e.status,t=e.state,u=e.isValid;if(r===m.ON_RESET)A(t,u),Q(n({},J.current,{status:m.RESETTED}));else if(r===m.ON_CHANGE)s(t,u);else if(r===m.ON_INIT)je(),C(t,u);else if(r===m.ON_SUBMIT){var a={isSubmitting:!1,status:m.READY};if(u){var c=k(t,u);if(c&&"function"==typeof c.then)c.then((function(){Q(n({},J.current,a,{submitted:J.current.submitted+1}))})).catch((function(){return Q(n({},J.current,a))}));else{var i=J.current.submitted;Q(n({},J.current,a,{submitted:!1===c?i:i+1}))}}else Q(n({},J.current,a))}!K||r!==m.ON_RESET&&r!==m.ON_CHANGE&&r!==m.ON_INIT&&r!==m.ON_SUBMIT||H(w,t)}),[J.current]),e.useEffect((function(){X.current=!0,T.length>0&&te("__$$USETHEFORM_VALIDATION$$__",ie.current),"function"==typeof D&&de("__$$USETHEFORM_VALIDATION$$__",oe.current,null);var e=K&&(null==U(w)||0===Object.keys(U(w)).length)||!K,r=K&&U(w)||J.current.state,t=V(re.current,r)&&S(ve.current);J.current=n({},J.current,{state:r,isValid:t,pristine:e,status:m.ON_INIT}),Q(J.current)}),[]),e.useEffect((function(){var e=L.status;e===m.ON_RESET?(xe.current=!1,Fe.current=!1,F(),j()):e!==m.READY&&e!==m.ON_INIT_ASYNC&&(null!==ce.current&&Me(!1,!0,!1),null===ce.current||ce.current.isValid||j())}),[ae.current,L.status]),n({},L,{formState:L.state,formStatus:L.status,mapFields:be.current,triggerSyncValidation:Me,unRegisterField:Se,updateRegisteredField:he,registerAsyncInitValidation:Pe,runAsyncValidation:De,dispatchNewState:Ie,changeProp:ge,initProp:Ee,onSubmitForm:Oe,removeProp:Re,stillMounted:Z,reset:ke,addValidators:te,removeValidators:ne,addValidatorsAsync:de,removeValidatorsAsync:fe,updateValidatorsMap:ye,registerReset:Ce,unRegisterReset:Ne})}var A=e.createContext(),_=e.createContext(),C=function(){var r=e.useContext(_);return{state:r.state,reset:r.reset,isValid:r.isValid,pristine:r.pristine,submitted:r.submitted,submitAttempts:r.submitAttempts,isSubmitting:r.isSubmitting,formStatus:r.formStatus,dispatch:r.dispatchNewState,onSubmitForm:r.onSubmitForm}};function N(){var r=e.useContext(A),t=e.useContext(_);return r||t}function k(r){var a=r.children,c=r.initialState,i=r.onChange,o=r.onInit,s=r.onReset,l=r.onSubmit,d=r.onValidation,f=r.resetSyncErr,v=r.validators,y=r.asyncValidator,m=r.onAsyncValidation,p=r.resetAsyncErr,V=r.reducers,S=r.touched,b=r._getInitilaStateForm_,h=r._onMultipleForm_,g=r.name,E=r.action,A=r.innerRef,C=u(r,["children","initialState","onChange","onInit","onReset","onSubmit","onValidation","resetSyncErr","validators","asyncValidator","onAsyncValidation","resetAsyncErr","reducers","touched","_getInitilaStateForm_","_onMultipleForm_","name","action","innerRef"]),N=R({initialState:c,touched:S,onChange:i,onInit:o,onReset:s,onSubmit:l,onValidation:d,resetSyncErr:f,validators:v,asyncValidator:y,onAsyncValidation:m,resetAsyncErr:p,reducers:V,_getInitilaStateForm_:b,_onMultipleForm_:h,name:g,action:E}),k=N.onSubmitForm,O=u(N,["onSubmitForm"]),I=e.useMemo((function(){return O}),[O.state,O.isValid,O.status,O.pristine,O.isSubmitting,O.submitAttempts,O.submitted]);return t.default.createElement(_.Provider,{value:I},t.default.createElement("form",n({action:E,onSubmit:k},C,{name:g,ref:A}),a))}var O=e.memo(k),I=e.createContext(),x=-1;function F(r){return function(e){var n,u;function a(r){var t;return(t=e.call(this,r)||this).state={id:x+=1,getID:t.getID},t}(n=a).prototype=Object.create((u=e).prototype),n.prototype.constructor=n,n.__proto__=u;var c=a.prototype;return c.getID=function(){return++x},c.render=function(){return t.default.createElement(I.Provider,{value:this.state},t.default.createElement(r,this.props))},a}(e.PureComponent)}var M=function(r,t,n){var u=e.useRef(t),a=e.useContext(I),c=void 0!==a?a.id:1,i=e.useCallback((function(e){u.current=e}),[]);return"array"===r.type&&(void 0!==n?(c=a.getID(),u.current=n):void 0===u.current&&(u.current=r.getIndex(c))),{nameProp:u,uniqueIDarrayContext:c,setNameProp:i}},T=[];function P(r){var t=N(),a=r.name,c=r.validators,i=void 0===c?T:c,o=r.asyncValidator,s=r.type,f=r.onFocus,p=void 0===f?v:f,V=r.onBlur,S=void 0===V?v:V,b=r.onChange,h=void 0===b?v:b,g=r.onValidation,E=void 0===g?v:g,R=r.resetSyncErr,A=void 0===R?v:R,_=r.resetAsyncErr,C=void 0===_?v:_,k=r.onAsyncValidation,O=r.value,I=void 0===O?"":O,x=r.checked,F=void 0!==x&&x,P=r.touched,j=void 0!==P&&P,D=r.multiple,Y=void 0!==D&&D,B=r.reducers,$=M(t,a,r.index),U=$.nameProp,H=$.uniqueIDarrayContext,w=$.setNameProp,G=t.state,q=e.useRef(null);q.current=t.formState;var L=e.useRef(!1),z=e.useRef(I),J=e.useRef(F),K=e.useRef(""),Q=e.useRef(null),W=e.useRef(null),X=function(r,t,n,u,a,c,i){var o=u,s=a;void 0===t[n.current]||c.current||i.stillMounted()||("radio"!==r&&""===o&&(o=t[n.current]),!1===a&&("checkbox"===r||"radio"===r&&t[n.current]===u)&&(s=!0));var l=e.useRef(o),d=e.useRef(s);return[l,d]}(s,G,U,I,F,L,t),Z=X[0],ee=X[1];!L.current&&Z.current?z.current=Z.current:"checkbox"===s||"radio"===s?(z.current=Z.current,J.current="checkbox"===s?void 0!==G[U.current]||!L.current&&!0===F:G[U.current]===Z.current):"select"===s?z.current=void 0!==G[U.current]?G[U.current]:Y?[]:"":"file"===s?(z.current=G[U.current],K.current=void 0!==G[U.current]?K.current:""):z.current="custom"===s||void 0!==G[U.current]?G[U.current]:"";var re=e.useMemo((function(){return y(B)}),[]),te=e.useCallback((function(e){switch(Q.current=null,W.current=null,s){case"number":case"range":var r=re(""!==Z.current?Number(Z.current):Z.current,z.current,e);return""===r?void 0:r;case"radio":case"checkbox":J.current=ee.current;var t=re(Z.current,z.current,e);return!1===ee.current?void 0:t;default:var n=re(Z.current,z.current,e);return""===n?void 0:n}}),[]),ne=e.useCallback((function(e,r){var n=re(e,z.current,q.current);h(n,r),t.changeProp(U.current,n,!1)}),[]),ue=e.useCallback((function(e){"function"==typeof e.persist&&e.persist();var r,t=e.target;if("select"===s&&Y){var n=t.options;r=[];for(var u=0,a=n.length;a>u;u++)n[u].selected&&r.push(n[u].value)}else"file"===s?(r=Y?function(e){for(var r=[],t=0,n=e.length;n>t;t++)r.push(e[t]);return r}(t.files):t.files[0],K.current=t.value):r="checkbox"===s?!0===J.current?"":Z.current||t.value||!0:"radio"===s?Z.current||t.value||!0:("number"===s||"range"===s)&&""!==t.value?Number(t.value):t.value;ne(r,e)}),[]),ae=e.useCallback((function(e){var r="function"==typeof e?e(z.current):e;ne(r)}),[]);e.useEffect((function(){if(L.current=!0,"array"===t.type&&t.registerIndex(H,w),i.length>0&&t.addValidators(U.current,se.current),t.updateRegisteredField(U.current,ae),"function"==typeof o&&(t.addValidatorsAsync(U.current,le.current,!1),""===I&&""===Z.current||t.registerAsyncInitValidation(U.current,(function(){return Q.current=Z.current,le.current(Z.current).then((function(){t.updateValidatorsMap(U.current,!0,1)})).catch((function(e){throw"cancelled"!==e&&t.updateValidatorsMap(U.current,!1,1),e}))}))),"radio"===s&&!0===ee.current&&t.registerReset(U.current,te),"radio"!==s&&t.registerReset(U.current,te),"checkbox"!==s&&"radio"!==s&&""!==I||("checkbox"===s||"radio"===s)&&F){var e=I;"checkbox"===s?e="checkbox"===s?I||!0:I:"number"!==s&&"range"!==s||(e=Number(e));var r=re(e,I,q.current);t.initProp(U.current,r,e)}return function(){A(),C(),t.stillMounted()&&(t.unRegisterField(U.current),"function"==typeof o&&t.removeValidatorsAsync(U.current,le.current),i.length>0&&t.removeValidators(U.current,se.current),t.removeProp(U.current,{removeCurrent:!0,removeInitial:!0},!0),t.unRegisterReset(U.current),"array"===t.type&&t.removeIndex(H))}}),[]);var ce=l(i),ie=ce.validationMsg,oe=ce.validationObj,se=ce.validationFN,le=d(o,k)[0],de=e.useState((function(){return!1})),fe=de[0],ve=de[1],ye=e.useState((function(){return!1})),me=ye[0],pe=ye[1],Ve=e.useState((function(){return!1})),Se=Ve[0],be=Ve[1];return e.useEffect((function(){if(t.formStatus===m.ON_RESET)ve(!1),be(!1),pe(!1),A(),C();else if(t.formStatus!==m.READY&&t.formStatus!==m.ON_INIT_ASYNC){var e="radio"===s||"checkbox"===s,r="select"===s&&Y;W.current!==z.current&&null!==oe.current&&(!e&&""!==I||"custom"===s&&j&&fe||t.formStatus===m.ON_SUBMIT||!e&&(j&&fe||!j&&r&&(fe||null===W.current)||!j&&!r)||e&&me)&&(W.current=z.current,E(oe.current.checks,oe.current.isValid)),fe&&(null==t||null==t.triggerSyncValidation||t.triggerSyncValidation()),(null!==oe.current&&oe.current.isValid||0===i.length)&&Se&&t.formStatus!==m.ON_SUBMIT&&t.formStatus!==m.ON_INIT_ASYNC&&"function"==typeof o&&Q.current!==z.current&&(Q.current=z.current,t.runAsyncValidation({start:!0}),le.current(z.current).then((function(){t.updateValidatorsMap(U.current,!0,1),t.runAsyncValidation({end:!0})})).catch((function(e){"cancelled"!==e&&(t.updateValidatorsMap(U.current,!1,1),t.runAsyncValidation({end:!0}))})))}}),[ie.current,fe,Se,me,t.formStatus]),function(e){switch(e.type){case"file":var r=e.fileValue;return n({},u(e,["value","setValue","fileValue"]),{value:r});case"select":return u(e,["type","setValue","fileValue"]);case"custom":return u(e,["fileValue"]);default:return u(e,["fileValue","setValue"])}}({onChange:ue,onBlur:e.useCallback((function(e){e.persist(),be(!0),ve(!0),S(e)}),[]),onFocus:e.useCallback((function(e){e.persist(),ve(!1),be(!1),pe(!0),p(e)}),[]),checked:J.current,value:z.current,fileValue:K.current,type:s,name:a,multiple:Y,setValue:ae})}var j=F((function(e){var r=e.onFocus,a=e.onBlur,c=e.onChange,i=e.name,o=e.index,s=e.checked,l=e.validators,d=e.asyncValidator,f=e.onValidation,v=e.onAsyncValidation,y=e.resetSyncErr,m=e.resetAsyncErr,p=e.type,V=e.value,S=e.touched,b=e.multiple,h=e.reducers,g=e.innerRef,E=u(e,["onFocus","onBlur","onChange","name","index","checked","validators","asyncValidator","onValidation","onAsyncValidation","resetSyncErr","resetAsyncErr","type","value","touched","multiple","reducers","innerRef"]),R=P({onFocus:r,onBlur:a,onChange:c,type:p,name:i,index:o,checked:s,value:V,validators:l,asyncValidator:d,onValidation:f,onAsyncValidation:v,reducers:h,resetSyncErr:y,resetAsyncErr:m,touched:S,multiple:b});return t.default.createElement("input",n({},E,R,{ref:g}))})),D=F((function(e){var r=e.onFocus,a=e.onBlur,c=e.onChange,i=e.children,o=e.name,s=e.index,l=e.validators,d=e.asyncValidator,f=e.onValidation,v=e.onAsyncValidation,y=e.resetSyncErr,m=e.resetAsyncErr,p=e.multiple,V=e.value,S=e.touched,b=e.reducers,h=e.innerRef,g=u(e,["onFocus","onBlur","onChange","children","name","index","validators","asyncValidator","onValidation","onAsyncValidation","resetSyncErr","resetAsyncErr","multiple","value","touched","reducers","innerRef"]),E=P({onFocus:r,onBlur:a,onChange:c,type:"select",name:o,index:s,value:V,validators:l,asyncValidator:d,onValidation:f,onAsyncValidation:v,resetSyncErr:y,resetAsyncErr:m,touched:S,multiple:p,reducers:b});return t.default.createElement("select",n({},g,E,{ref:h}),i)})),Y=F((function(e){var r=e.onFocus,a=e.onBlur,c=e.onChange,i=e.name,o=e.index,s=e.validators,l=e.asyncValidator,d=e.onValidation,f=e.onAsyncValidation,v=e.resetSyncErr,y=e.resetAsyncErr,m=e.value,p=e.touched,V=e.reducers,S=e.innerRef,b=u(e,["onFocus","onBlur","onChange","name","index","validators","asyncValidator","onValidation","onAsyncValidation","resetSyncErr","resetAsyncErr","value","touched","reducers","innerRef"]),h=P({onFocus:r,onBlur:a,onChange:c,type:"text",name:i,index:o,value:m,validators:s,asyncValidator:l,onValidation:d,onAsyncValidation:f,resetSyncErr:v,resetAsyncErr:y,touched:p,reducers:V});return t.default.createElement("textarea",n({},b,h,{ref:S}))})),B=[],$={},U=[];function H(r){var t=N(),u=r.type,a=r.value,i=r.reducers,s=r.validators,p=void 0===s?U:s,V=r.onValidation,S=void 0===V?v:V,b=r.resetSyncErr,h=void 0===b?v:b,g=r.resetAsyncErr,E=void 0===g?v:g,R=r.asyncValidator,A=r.onAsyncValidation,_=void 0===A?v:A,C=r.touched,k=void 0!==C&&C,O=M(t,r.name,r.index),I=O.nameProp,x=O.uniqueIDarrayContext,F=O.setNameProp,T=o(I,t,u),P=T.unRegisterField,j=T.mapFields,D=T.updateRegisteredField,Y=e.useMemo((function(){return y(i)}),[]),H=e.useRef(!1),w=e.useCallback((function(){return H.current}),[]),G=u&&"array"===u,q=a||(G?B:$),L=e.useRef(q),z=e.useRef(q),J=e.useRef(G?B:$),K=e.useRef(null);L.current=H.current?t.state[I.current]||(G?B:$):a||t.state[I.current]||q;var Q=e.useRef(null);Q.current=t.formState;var W=e.useRef(G?[]:{}),X=e.useCallback((function(e,r){W.current=G?[].concat(W.current):n({},W.current),G&&void 0!==W.current[e]?W.current.splice(Number(e),0,r):W.current[e]=r}),[]),Z=e.useCallback((function(e){W.current.constructor===Array?W.current.splice(e,1):delete W.current[e]}),[]),ee=e.useCallback((function(e){K.current=null;var r=G?[]:{},t=Object.keys(W.current).reduce((function(r,t){var n=W.current[t](e);return void 0!==n&&(r[t]=n),r}),r),n=Y(t,z.current,e);return n=void 0!==n&&Object.keys(n).length>0?n:void 0}),[]),re=e.useCallback((function(e){var r=Y(e,L.current,Q.current);t.changeProp(I.current,r,0===Object.keys(r).length)}),[]),te=e.useCallback((function(e,r,t){var n=f(L.current,{value:r,nameProp:e,removeMe:t});re(n)}),[]),ne=e.useCallback((function(e,r,n,u){void 0===u&&(u=!0);var a=f(L.current,{value:r,nameProp:e,add:H.current&&u});z.current=f(z.current,{value:n,nameProp:e,add:H.current&&u});var c=Y(a,L.current,Q.current);J.current=a,H.current?t.initProp(I.current,c,z.current,!1):L.current=c}),[]),ue=e.useRef((function(e,r,n){var u=r.initialState,a=r.removeInitial;void 0===n&&(n=!1);var c=f(L.current,{value:r.currentState,nameProp:e,removeMe:r.removeCurrent}),i=f(z.current,{value:u,nameProp:e,removeMe:a});n&&G&&(c=c.filter((function(r,t){return t!==e})),i=i.filter((function(r,t){return t!==e})));var o=Y(c,L.current,Q.current);L.current=o,z.current=i,t.removeProp(I.current,{currentState:L.current,removeCurrent:0===Object.keys(L.current).length,initialState:z.current,removeInitial:0===Object.keys(z.current).length})})).current,ae=e.useCallback((function(e){var r="function"==typeof e?e(L.current):e;re(r)}),[]),ce=c(t,I,H),ie=ce[0],oe=ce[1],se=ce[2],le=c(t,I,H,!0),de=le[0],fe=le[1],ve=le[2],ye=le[3],me=le[4],pe=l(p),Ve=pe.validationMsg,Se=pe.validationObj,be=pe.validationFN,he=d(R,_)[0],ge=e.useCallback((function(e,r){if(void 0===e&&(e=!0),void 0===r&&(r=!1),K.current!==L.current){if(null!==Se.current&&(k||r)){K.current=L.current;var n=Se.current;S(n.checks,n.isValid)}e&&(null==t||null==t.triggerSyncValidation||t.triggerSyncValidation())}}),[]);e.useEffect((function(){t.formStatus===m.ON_RESET?(h(),E()):t.formStatus!==m.READY&&t.formStatus!==m.ON_INIT_ASYNC&&(null!==Se.current&&t.formStatus===m.ON_SUBMIT&&ge(!1,!0),null===Se.current||Se.current.isValid||E())}),[Ve.current,t.formStatus]);var Ee=e.useRef({}),Re=e.useCallback((function(e,r){Ee.current[e]=r}),[]);e.useEffect((function(){H.current=!0,"array"===t.type&&t.registerIndex(x,F),p.length>0&&t.addValidators(I.current,be.current),"function"==typeof R&&t.addValidatorsAsync(I.current,he.current,null),j.current.__$$USETHEFORM_DISPATCHER$$__=ae,t.updateRegisteredField(I.current,j.current),Object.keys(Ee.current).length>0&&t.registerAsyncInitValidation(I.current,Ee.current),Object.keys(ie.current).length>0&&t.addValidators(I.current,ie.current),Object.keys(de.current).length>0&&t.addValidatorsAsync(I.current,de.current,ye.current),t.registerReset(I.current,ee);var e=Y(L.current,J.current,Q.current);return t.initProp(I.current,e,z.current),function(){h(),E(),H.current=!1,t.stillMounted()&&(t.unRegisterField(I.current),"function"==typeof R&&t.removeValidatorsAsync(I.current,he.current,!1),p.length>0&&t.removeValidators(I.current,be.current),Object.keys(ie.current).length>0&&t.removeValidators(I.current,ie.current),Object.keys(de.current).length>0&&t.removeValidatorsAsync(I.current,de.current,ye.current),t.removeProp(I.current,{removeCurrent:!0,removeInitial:!0},!0),t.unRegisterReset(I.current),"array"===t.type&&t.removeIndex(x))}}),[]);var Ae=e.useRef({}),_e=e.useCallback((function(e){return void 0===Ae.current[e]&&(Ae.current[e]=null),Object.keys(Ae.current).length-1}),[]),Ce=e.useCallback((function(e){delete Ae.current[e],Object.keys(Ae.current).forEach((function(e,r){return Ae.current[e](r)}))}),[]),Ne=e.useCallback((function(e,r){Ae.current[e]=r}),[]);return{state:L.current,formState:t.formState,formStatus:t.formStatus,runAsyncValidation:t.runAsyncValidation,unRegisterField:P,updateRegisteredField:D,registerAsyncInitValidation:Re,changeProp:te,initProp:ne,removeProp:ue,stillMounted:w,getIndex:_e,removeIndex:Ce,registerIndex:Ne,type:u,addValidators:oe,removeValidators:se,addValidatorsAsync:fe,removeValidatorsAsync:ve,updateValidatorsMap:me,registerReset:X,unRegisterReset:Z,triggerSyncValidation:ge}}var w=F((function(r){var n=r.children,u=H({name:r.name,index:r.index,touched:r.touched,type:r.object?"object":"array",value:r.value,reducers:r.reducers,onValidation:r.onValidation,validators:r.validators,resetSyncErr:r.resetSyncErr,asyncValidator:r.asyncValidator,onAsyncValidation:r.onAsyncValidation,resetAsyncErr:r.resetAsyncErr}),a=e.useMemo((function(){return u}),[u.state,u.formStatus]);return t.default.createElement(A.Provider,{value:a},n)})),G=e.memo((function(r){var n=r.children,u=R({initialState:r.initialState,onChange:r.onChange,onInit:r.onInit,onReset:r.onReset,onSubmit:r.onSubmit,onValidation:r.onValidation,resetSyncErr:r.resetSyncErr,validators:r.validators,asyncValidator:r.asyncValidator,onAsyncValidation:r.onAsyncValidation,resetAsyncErr:r.resetAsyncErr,touched:r.touched,reducers:r.reducers,_getInitilaStateForm_:r._getInitilaStateForm_,_onMultipleForm_:r._onMultipleForm_,name:r.name,action:r.action}),a=e.useMemo((function(){return u}),[u.state,u.isValid,u.status,u.pristine,u.isSubmitting,u.submitAttempts,u.submitted]);return t.default.createElement(_.Provider,{value:a},n)})),q={error:void 0,isValid:!0};var L={status:void 0,value:void 0};function z(e){return Object.keys(e).reduce((function(r,t){return n({},r,e[t])}),{})}exports.Collection=w,exports.Form=O,exports.FormContext=G,exports.Input=j,exports.STATUS=m,exports.Select=D,exports.TextArea=Y,exports.default=O,exports.getValueByPath=p,exports.useAsyncValidation=function(r){var t=e.useState((function(){return n({},L)})),u=t[0],a=t[1];return[u,{onAsyncValidation:function(e){return a(n({},u,e))},asyncValidator:r,resetAsyncErr:function(){return a(n({},L))}}]},exports.useChildren=function(r,t){void 0===r&&(r=[]),void 0===t&&(t=v);var n=e.useState((function(){return r})),u=n[0],a=n[1],c=C().formStatus;return e.useEffect((function(){c===m.ON_RESET&&(a([]),t())}),[c]),[u,a]},exports.useCollection=function(r){var t=H({name:r.name,index:r.index,type:r.type,value:r.value,reducers:r.reducers,onValidation:r.onValidation,validators:r.validators,resetSyncErr:r.resetSyncErr,asyncValidator:r.asyncValidator,onAsyncValidation:r.onAsyncValidation,resetAsyncErr:r.resetAsyncErr}),n=t.changeProp,u=t.state,a=t.formState;return{updateCollection:e.useCallback((function(e,r){return n(e,r)}),[]),value:u,state:a}},exports.useField=P,exports.useForm=C,exports.useMultipleForm=function(r){var t=e.useRef({}),n=e.useRef((function(e,n){t.current[e]=n,"function"==typeof r&&r(z(t.current))})).current,u=e.useRef((function(e){return t.current[e]})).current;return[e.useRef((function(){return z(t.current)})).current,{_getInitilaStateForm_:u,_onMultipleForm_:n}]},exports.useSelector=function(r){var t,n,u=e.useContext(_),a=u.state,c=u.mapFields;try{t=r(a)}catch(e){t=void 0}try{var i=r(c);n=(null==i?void 0:i.__$$USETHEFORM_DISPATCHER$$__)||i}catch(e){n=void 0}return[t,n]},exports.useValidation=function(r){void 0===r&&(r=[]);var t=e.useState((function(){return n({},q)})),u=t[1];return[t[0],{onValidation:function(e,r){return u({error:s(e),isValid:r})},validators:r,resetSyncErr:function(){return u(n({},q))}}]},exports.withIndex=F;
